<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Label Pengiriman #{{ transaction.id }} - BarterHub</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 20px;
            background: white;
            font-size: 12px;
            line-height: 1.4;
        }

        .receipt-container {
            max-width: 800px;
            margin: 0 auto;
            border: 3px solid #000;
            padding: 20px;
            background: white;
        }

        .receipt-title {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            border-bottom: 3px solid #000;
            padding-bottom: 15px;
            color: #2c3e50;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            border-bottom: 2px solid #ddd;
            padding-bottom: 15px;
        }

        .logo {
            font-size: 18px;
            font-weight: bold;
            color: #3498db;
        }

        .header-info {
            text-align: right;
            font-size: 11px;
            color: #555;
        }

        .warning-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 8px;
            text-align: center;
        }

        .warning-box h3 {
            color: #856404;
            margin: 0 0 10px 0;
            font-size: 16px;
        }

        .warning-text {
            color: #856404;
            font-weight: bold;
            font-size: 14px;
        }

        .instructions {
            background: #e7f3ff;
            border: 2px solid #0066cc;
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 8px;
        }

        .instructions h4 {
            margin: 0 0 15px 0;
            color: #0066cc;
            font-size: 16px;
            text-align: center;
        }

        .instructions ol {
            margin: 0;
            padding-left: 25px;
        }

        .instructions li {
            margin-bottom: 8px;
            font-size: 12px;
            color: #0066cc;
            font-weight: 500;
        }

        .cost-info {
            background: #ffebee;
            border: 2px solid #f44336;
            padding: 15px;
            margin-bottom: 25px;
            border-radius: 8px;
            text-align: center;
        }

        .cost-info h4 {
            color: #d32f2f;
            margin: 0 0 10px 0;
            font-size: 14px;
        }

        .cost-info p {
            margin: 5px 0;
            color: #d32f2f;
            font-size: 12px;
            font-weight: 500;
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        .info-section {
            border: 2px solid #333;
            padding: 15px;
            border-radius: 5px;
        }

        .info-title {
            font-weight: bold;
            margin-bottom: 10px;
            background: #333;
            color: white;
            padding: 8px;
            text-align: center;
            margin: -15px -15px 15px -15px;
            font-size: 14px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px dotted #ccc;
        }

        .info-label {
            font-weight: bold;
            color: #333;
            font-size: 11px;
        }

        .info-value {
            color: #555;
            text-align: right;
            font-size: 11px;
        }

        .address-section {
            margin-top: 25px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .address-box {
            border: 3px solid #000;
            padding: 20px;
            min-height: 140px;
            border-radius: 5px;
        }

        .address-title {
            font-weight: bold;
            text-align: center;
            margin-bottom: 15px;
            background: #000;
            color: white;
            padding: 10px;
            margin: -20px -20px 15px -20px;
            font-size: 16px;
        }

        .address-content {
            font-size: 12px;
            line-height: 1.8;
            font-weight: 500;
        }

        .reference-section {
            text-align: center;
            margin-top: 25px;
            border-top: 3px solid #000;
            padding-top: 20px;
        }

        .reference-code {
            font-size: 24px;
            font-weight: bold;
            letter-spacing: 3px;
            margin: 15px 0;
            background: #f0f0f0;
            padding: 15px;
            border: 2px solid #333;
            border-radius: 5px;
        }

        .footer-info {
            margin-top: 25px;
            padding: 20px;
            background: #f8f9fa;
            border: 2px solid #6c757d;
            border-radius: 8px;
            font-size: 11px;
            color: #495057;
        }

        .step-box {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .step {
            background: white;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
        }

        .step-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 13px;
        }

        .alert {
            position: relative;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid transparent;
            border-radius: 0.25rem;
        }

        .alert-warning {
            color: #856404;
            background-color: #fff3cd;
            border-color: #ffeeba;
        }

        .alert h6 {
            margin-top: 0;
            margin-bottom: 0.5rem;
        }

        .fas, .me-1 {
            margin-right: 0.25rem;
        }

        .fs-4 {
            font-size: 1.5rem !important;
        }

        .fw-bold {
            font-weight: 700 !important;
        }

        .text-center {
            text-align: center !important;
        }

        .py-2 {
            padding-top: 0.5rem !important;
            padding-bottom: 0.5rem !important;
        }

        .text-muted {
            color: #6c757d !important;
        }

        @media print {
            body {
                margin: 0;
                padding: 10px;
            }

            .receipt-container {
                border: 2px solid #000;
                max-width: none;
            }

            .no-print {
                display: none;
            }
        }

        @page {
            size: A4;
            margin: 1cm;
        }
    </style>
</head>
<body>
    <div class="receipt-container">
        <div class="receipt-title">
            üè∑Ô∏è LABEL PRODUK & ALAMAT - UNTUK AGEN JASA KIRIM
        </div>

        <div class="header">
            <div class="logo">üîÑ BarterHub</div>
            <div class="header-info">
                Platform Barter Terpercaya Indonesia<br>
                www.barterhub.com | support@barterhub.com<br>
                <strong style="color: #e74c3c;">‚ö†Ô∏è BAWA LABEL INI KE AGEN (JNE/J&T/SiCepat/Wahana/dll)</strong>
            </div>
        </div>

        <!-- Warning Box -->
        <div class="warning-box">
            <h3>üö® PERINGATAN PENTING</h3>
            <div class="warning-text">
                Label ini BUKAN resi pengiriman!<br>
                Gunakan untuk daftar manual ke agen jasa kirim
            </div>
        </div>

        <!-- Cost Information -->
        <div class="cost-info">
            <h4>üí∞ INFORMASI BIAYA PENGIRIMAN BARTER</h4>
            <p><strong>Sistem pengiriman:</strong> Kedua pihak kirim barang ke alamat masing-masing</p>
            <p><strong>Ongkir ditanggung:</strong> Setiap orang bayar ongkir untuk mengirim barangnya</p>
            <p><strong>Total pengiriman:</strong> 2 paket terpisah (Penjual‚ÜíPembeli & Pembeli‚ÜíPenjual)</p>
            <p><strong>Pembayaran:</strong> Langsung ke agen (tidak melalui BarterHub)</p>
        </div>

        <!-- Instructions -->
        <div class="instructions">
            <h4>üìã LANGKAH-LANGKAH PENGIRIMAN:</h4>
            <ol>
                <li><strong>Cetak label ini</strong> dan bawa bersama barang yang akan dikirim</li>
                <li><strong>Kunjungi agen terdekat</strong> (JNE, J&T Express, SiCepat, Wahana, Pos Indonesia, dll)</li>
                <li><strong>Tunjukkan label ini</strong> untuk mendaftar pengiriman manual</li>
                <li><strong>Isi formulir agen</strong> dengan data dari label (nama, alamat, telepon)</li>
                <li><strong>Bayar ongkos kirim</strong> sesuai tarif agen yang dipilih</li>
                <li><strong>Ambil nomor resi</strong> dari agen dan simpan struk sebagai bukti</li>
                <li><strong>Input nomor resi</strong> di BarterHub untuk tracking pengiriman</li>
                <li><strong>Update status</strong> di aplikasi setelah barang terkirim</li>
            </ol>
        </div>

        <!-- Transaction Info -->
        <div class="info-grid">
            <div class="info-section">
                <div class="info-title">üìã Info Transaksi BarterHub</div>
                <div class="info-row">
                    <span class="info-label">ID Transaksi:</span>
                    <span class="info-value">#BH-{{ transaction.id }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Tanggal:</span>
                    <span class="info-value">{{ transaction.created_at.strftime('%d/%m/%Y %H:%M') }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Jenis Layanan:</span>
                    <span class="info-value">BARTER (Cash on Delivery)</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Total Poin:</span>
                    <span class="info-value">{{ transaction.total_seller_points + transaction.total_buyer_points }} Poin</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Estimasi Berat:</span>
                    <span class="info-value">1-2 kg (konfirmasi ke agen)</span>
                </div>
            </div>

            <div class="info-section">
                <div class="info-title">üì¶ Detail Produk yang Dikirim</div>
                <div class="info-row">
                    <span class="info-label">Nama Produk:</span>
                    <span class="info-value">{{ transaction.product.title[:25] }}{% if transaction.product.title|length > 25 %}...{% endif %}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Kondisi:</span>
                    <span class="info-value">{{ transaction.product.condition }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Kategori:</span>
                    <span class="info-value">{{ transaction.product.category.name if transaction.product.category else 'Lainnya' }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Platform:</span>
                    <span class="info-value">BarterHub.com</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Layanan:</span>
                    <span class="info-value">Barter/Tukar Barang</span>
                </div>
            </div>
        </div>

        <!-- Address Section -->
        <div class="address-section">
            <!-- Sender Address (Current User) -->
            <div class="address-box">
                <div class="address-title">üì§ DATA PENGIRIM (ANDA)</div>
                <div class="address-content">
                    <strong>{{ current_user.full_name|upper }}</strong><br>
                    <strong>Telp:</strong> {{ current_user.phone }}<br><br>
                    <strong>ALAMAT LENGKAP:</strong><br>
                    {{ current_user.address }}<br><br>
                    <strong>Kode Pos:</strong> (isi manual di agen)<br>
                    <strong>Email:</strong> {{ current_user.email }}
                </div>
            </div>

            <!-- Receiver Address (Partner) -->
            <div class="address-box">
                <div class="address-title">üì• DATA PENERIMA (PARTNER BARTER)</div>
                <div class="address-content">
                    {% if current_user.id == transaction.seller_id %}
                        <!-- Penjual kirim ke Pembeli -->
                        <div class="mb-3">
                            <h6>Alamat Penerima:</h6>
                            <address>
                                <strong>{{ transaction.buyer.full_name }}</strong><br>
                                {{ transaction.buyer.address }}<br>
                                {{ transaction.buyer.kode_pos }}<br>
                                Telp: {{ transaction.buyer.phone }}
                            </address>
                        </div>

                        {% if transaction.seller_confirmation_code %}
                        <div class="alert alert-warning mb-3">
                            <h6><i class="fas fa-key me-1"></i>KODE KONFIRMASI PENERIMA:</h6>
                            <div class="fs-4 fw-bold text-center py-2" style="letter-spacing: 3px; border: 2px dashed #000; background: #fff;">
                                {{ transaction.seller_confirmation_code }}
                            </div>
                            <small class="text-muted">
                                <strong>PENTING:</strong> Berikan kode ini kepada penerima untuk konfirmasi bahwa paket telah sampai dengan benar.
                            </small>
                        </div>
                        {% endif %}

                        <div style="margin-top: 15px; padding: 10px; background: #e3f2fd; border-radius: 5px;">
                            <strong>üì¶ Anda mengirim:</strong> {{ transaction.product.title }}<br>
                            <strong>üì• Akan menerima:</strong> Produk tawaran dari pembeli
                        </div>
                    {% else %}
                        <!-- Pembeli kirim ke Penjual -->
                        <div class="mb-3">
                            <h6>Alamat Penerima:</h6>
                            <address>
                                <strong>{{ transaction.seller.full_name }}</strong><br>
                                {{ transaction.seller.address }}<br>
                                {{ transaction.seller.kode_pos }}<br>
                                Telp: {{ transaction.seller.phone }}
                            </address>
                        </div>

                        {% if transaction.buyer_confirmation_code %}
                        <div class="alert alert-warning mb-3">
                            <h6><i class="fas fa-key me-1"></i>KODE KONFIRMASI PENERIMA:</h6>
                            <div class="fs-4 fw-bold text-center py-2" style="letter-spacing: 3px; border: 2px dashed #000; background: #fff;">
                                {{ transaction.buyer_confirmation_code }}
                            </div>
                            <small class="text-muted">
                                <strong>PENTING:</strong> Berikan kode ini kepada penerima untuk konfirmasi bahwa paket telah sampai dengan benar.
                            </small>
                        </div>
                        {% endif %}

                        <div style="margin-top: 15px; padding: 10px; background: #e8f5e8; border-radius: 5px;">
                            <strong>üì¶ Anda mengirim:</strong> 
                            {% set offers = transaction.offers.all() %}
                            {% if offers %}
                                {% for offer in offers %}
                                    {{ offer.product.title }}{% if not loop.last %}, {% endif %}
                                {% endfor %}
                            {% else %}
                                Produk tawaran
                            {% endif %}<br>
                            <strong>üì• Akan menerima:</strong> {{ transaction.product.title }}
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Reference Section -->
        <div class="reference-section">
            <h4 style="margin-bottom: 15px; color: #2c3e50;">üè∑Ô∏è KODE REFERENSI BARTERHUB</h4>
            <div class="reference-code">
                BH-{{ transaction.id }}-{{ transaction.created_at.strftime('%m%d%Y') }}
            </div>
            <div style="font-size: 12px; color: #666; margin-top: 10px;">
                Berikan kode ini ke agen untuk referensi transaksi barter BarterHub
            </div>
        </div>

        <!-- Next Steps -->
        <div class="step-box">
            <div class="step">
                <div class="step-title">üìù SETELAH KE AGEN:</div>
                <ul style="margin: 0; padding-left: 20px; font-size: 11px;">
                    <li>Dapatkan <strong>nomor resi</strong> dari agen</li>
                    <li>Simpan <strong>struk pembayaran</strong> ongkir</li>
                    <li>Foto <strong>bukti pengiriman</strong></li>
                </ul>
            </div>

            <div class="step">
                <div class="step-title">üì± INPUT KE BARTERHUB:</div>
                <ul style="margin: 0; padding-left: 20px; font-size: 11px;">
                    <li>Masuk ke <strong>detail transaksi</strong></li>
                    <li>Input <strong>nomor resi</strong> yang didapat</li>
                    <li>Update <strong>status pengiriman</strong></li>
                    <li>Share info ke <strong>partner barter</strong></li>
                </ul>
            </div>
        </div>

        <!-- Footer Info -->
        <div class="footer-info">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <strong>üìå CATATAN PENTING:</strong><br>
                    ‚Ä¢ Label ini untuk daftar manual ke agen jasa kirim<br>
                    ‚Ä¢ BarterHub belum bermitra resmi dengan ekspedisi<br>
                    ‚Ä¢ API tracking otomatis belum tersedia<br>
                    ‚Ä¢ Simpan nomor resi untuk update manual di app<br>
                    ‚Ä¢ Ongkir dibayar langsung ke agen (bukan ke BarterHub)
                </div>
                <div>
                    <strong>üõ°Ô∏è KEAMANAN TRANSAKSI:</strong><br>
                    ‚Ä¢ Verifikasi identitas penerima saat kirim<br>
                    ‚Ä¢ Foto barang sebelum dikemas<br>
                    ‚Ä¢ Simpan bukti pengiriman dan pembayaran<br>
                    ‚Ä¢ Laporkan masalah ke support BarterHub<br>
                    ‚Ä¢ Transaksi dilindungi sistem rating BarterHub
                </div>
            </div>

            <div style="text-align: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">
                <strong>Support BarterHub:</strong> +62 123 456 7890 | support@barterhub.com<br>
                <em>Label dicetak pada: {{ datetime.utcnow().strftime('%d/%m/%Y %H:%M:%S') }} WIB</em>
            </div>
        </div>
    </div>

    <script>
        window.onload = function() {
            // Auto print when page loads
            setTimeout(function() {
                window.print();
            }, 500);
        }
    </script>
</body>
</html>